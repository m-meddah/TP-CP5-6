!function(){var e={base_url:"http://localhost:3000",hideModals:function(){const e=document.querySelectorAll(".modal");for(const t of e)t.classList.remove("is-active")}};const t={makeTagInDOM:function(e){const a=document.createElement("span");a.classList.add("tag"),a.textContent=e.name,a.style.backgroundColor=e.color,a.dataset.tagId=e.id,a.addEventListener("dblclick",t.dissociateTagToCard),document.querySelector(`[data-card-id="${e.card_has_tag.card_id}"]`).appendChild(a)},dissociateTagToCard:async function(t){const a=t.target.dataset.tagId,o=t.target.closest(".box").dataset.cardId;try{await fetch(`${e.base_url}/cards/${o}/tag/${a}`,{method:"DELETE"}),t.target.remove()}catch(s){console.error(s),alert("Impossible de dissocier le tag de la carte !")}},showAssociateTagModal:function(e){const t=document.querySelector("#associateTagModal");t.querySelector('input[name="card_id"]').value=e.target.closest(".box").dataset.cardId,t.classList.add("is-active")},handleAssociateTagForm:async function(a){a.preventDefault();const o=new FormData(a.target),s=o.get("card_id"),d=await fetch(`${e.base_url}/cards/${s}/tag`,{method:"POST",body:o}),r=(await d.json()).tagsList.find(e=>e.id===Number(o.get("tagId")));t.makeTagInDOM(r),e.hideModals()}};var a=t;const o={handleAddCardForm:async function(t){t.preventDefault();const a=new FormData(t.target);try{const t=await fetch(e.base_url+"/cards",{method:"POST",body:a}),s=await t.json();o.makeCardInDOM(s)}catch(s){console.error(s),alert("Impossible de cr\xe9er la carte !")}t.target.reset(),e.hideModals()},makeCardInDOM:function(e){const t=document.getElementById("templateCard").content.cloneNode(!0);t.querySelector(".column").textContent=e.description;const s=t.querySelector(".box");s.dataset.cardId=e.id,s.style.backgroundColor=e.color,s.querySelector('input[name="card_id"]').value=e.id,s.querySelector(".btn-edit-card").addEventListener("click",o.showEditCardForm),s.querySelector("form").addEventListener("submit",o.handleEditCardForm),s.querySelector(".btn-delete-card").addEventListener("click",o.deleteCard),s.querySelector(".btn-associate-tag").addEventListener("click",a.showAssociateTagModal),document.querySelector(`.panel[data-list-id="${e.list_id}"]`).querySelector(".panel-block").appendChild(t)},deleteCard:async function(t){const a=t.target.closest(".box"),o=a.dataset.cardId;try{await fetch(`${e.base_url}/cards/${o}`,{method:"DELETE"}),a.remove()}catch(s){console.error(s),alert("Impossible de supprimer la carte !")}},handleEditCardForm:async function(t){t.preventDefault();const a=new FormData(t.target);try{await fetch(`${e.base_url}/cards/${a.get("card_id")}`,{method:"PATCH",body:a});const o=t.target.closest(".box");a.get("description")&&(o.querySelector(".title-card").textContent=a.get("description")),o.style.backgroundColor=a.get("color"),t.target.classList.add("is-hidden"),o.querySelector(".title-card").classList.remove("is-hidden")}catch(o){console.error(o),alert("Impossible de modifier la carte !")}},showEditCardForm:function(e){const t=e.target.closest(".box");t.querySelector(".title-card").classList.add("is-hidden"),t.querySelector("form").classList.remove("is-hidden")},showAddCardModal:function(e){const t=e.target.closest(".panel").dataset.listId;document.querySelector('#addCardModal input[name="list_id"]').value=t,document.getElementById("addCardModal").classList.add("is-active")},moveCards:function(t){t.querySelectorAll(".box").forEach(async(a,o)=>{const s=a.dataset.cardId,d=new FormData;d.set("position",o);const r=t.closest(".panel").dataset.listId;d.set("list_id",r),await fetch(`${e.base_url}/cards/${s}`,{method:"PATCH",body:d})})}};var s=o;const d={handleAddListForm:async function(t){t.preventDefault();const a=new FormData(t.target);try{const t=await fetch(e.base_url+"/lists",{method:"POST",body:a}),o=await t.json();d.makeListInDOM(o)}catch(o){console.error(o),alert("Impossible de cr\xe9er la liste !")}e.hideModals(),t.target.reset()},makeListInDOM:function(e){const t=document.getElementById("templateList").content.cloneNode(!0);t.querySelector("h2").textContent=e.name,t.querySelector(".panel").dataset.listId=e.id,t.querySelector('input[name="list_id"]').value=e.id,t.querySelector("h2").addEventListener("dblclick",d.showEditListForm),t.querySelector("form").addEventListener("submit",d.handleEditListForm),t.querySelector(".btn-add-card").addEventListener("click",s.showAddCardModal),t.querySelector(".btn-delete-list").addEventListener("click",d.deleteList);const a=t.querySelector(".panel-block");new Sortable(a,{draggable:".box",group:"list",onEnd:function(e){const t=e.from,a=e.to;s.moveCards(t),t!==a&&s.moveCards(a)}}),document.querySelector(".card-lists").appendChild(t)},deleteList:async function(t){if(confirm("Voulez-vous vraiment supprimer cette liste ?")){const o=t.target.closest(".panel"),s=o.dataset.listId;try{await fetch(`${e.base_url}/lists/${s}`,{method:"DELETE"}),o.remove()}catch(a){console.error(a),alert("Impossible de supprimer cette liste !")}}},handleEditListForm:async function(t){t.preventDefault();const a=new FormData(t.target);try{if((await fetch(`${e.base_url}/lists/${a.get("list_id")}`,{method:"PATCH",body:a})).ok){t.target.reset(),t.target.classList.add("is-hidden");const e=t.target.previousElementSibling;a.get("name")&&(e.textContent=a.get("name")),e.classList.remove("is-hidden")}}catch(o){console.error(o),alert("Impossible de modifier la liste !")}},showEditListForm:function(e){e.target.classList.add("is-hidden"),e.target.nextElementSibling.classList.remove("is-hidden")},showAddListModal:function(){document.getElementById("addListModal").classList.add("is-active")}};var r=d;const n={init:function(){n.addListenerToActions(),n.getListsFromAPI();const t=document.querySelector(".card-lists");new Sortable(t,{draggable:".panel",onEnd:function(){document.querySelectorAll(".panel").forEach(async(t,a)=>{const o=t.dataset.listId,s=new FormData;s.set("position",a),await fetch(`${e.base_url}/lists/${o}`,{method:"PATCH",body:s})})}}),n.fillSelectTagModal()},getListsFromAPI:async function(){try{const t=await fetch(e.base_url+"/lists"),o=await t.json();for(const e of o){r.makeListInDOM(e);for(const t of e.cardsList){s.makeCardInDOM(t);for(const e of t.tagsList)a.makeTagInDOM(e)}}}catch(t){console.error(t)}},addListenerToActions:function(){document.getElementById("addListButton").addEventListener("click",r.showAddListModal),document.querySelectorAll(".close").forEach(t=>{t.addEventListener("click",e.hideModals)}),document.querySelector("#addListModal form").addEventListener("submit",r.handleAddListForm),document.querySelector("#addCardModal form").addEventListener("submit",s.handleAddCardForm),document.querySelector("#associateTagModal form").addEventListener("submit",a.handleAssociateTagForm)},fillSelectTagModal:async function(){try{const t=await fetch(e.base_url+"/tags"),a=await t.json(),o=document.querySelector('#associateTagModal select[name="tagId"]');for(const e of a){const t=document.createElement("option");t.textContent=e.name,t.value=e.id,o.appendChild(t)}}catch(t){console.error(t),alert("Impossible de r\xe9cup\xe9rer les tags !")}}};document.addEventListener("DOMContentLoaded",n.init)}();